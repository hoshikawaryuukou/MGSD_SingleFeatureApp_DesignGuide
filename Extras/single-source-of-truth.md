# 單一數據源 (Single Source of Truth, SSoT)

## 核心概念

「單一數據源」是一項核心架構原則，意指在應用程式中，任何一份給定的資訊（例如玩家當前的生命值、背包裡的物品列表），都必須有且僅有一個**唯一、權威的來源 (Authoritative Source)**。所有需要該資訊的模組都必須從此來源讀取；所有對該資訊的修改，也必須通過此來源定義的管道進行。

## 為何至關重要

- **確保數據一致性**：這是解決「狀態同步噩夢」的根本解法。當多個模組（如 UI、遊戲邏輯、存檔系統）都各自維護一份玩家金錢的狀態時，數據不一致的錯誤將層出不窮。SSoT 從設計上杜絕了這個問題。
- **提升系統可預測性**：數據流變得單向且清晰。當 bug 發生時，開發者可以快速追溯到唯一的數據源頭，而不必在數個潛在的數據副本之間猜測問題的根源，大幅降低了除錯的複雜度。

## 在本架構中的實踐

在本架構中，單一數據源的核心是位於 **`Application` 層的 `Store` 模組**。所有狀態的生命週期都圍繞著一套清晰、單向的流程展開。

1.  **`Application/Stores`：權威的狀態容器**
    `Store`（例如 `PlayerStore`, `InventoryStore`）是應用程式運行期間，**唯一可信的狀態副本**。它的職責被嚴格限定：
    - **持有狀態**：它負責儲存特定領域的運行時數據。
    - **暴露狀態**：它以**響應式資料流 (Reactive Stream)** 的形式，將狀態**唯讀**地暴露給外部（主要是 `Presenter`）。
    - **受控的寫入**：`Store` 的**寫入方法被嚴格保護**（通常設為 `internal`），確保只有同在 `Application` 層的 `UseCase` 才有權限修改其狀態。`Store` 本身不包含複雜的業務邏輯，它是一個被動的狀態管理者。

2.  **`Application/UseCases`：狀態變更的唯一入口**
    `UseCase` 是整個流程的**協調者**與**業務邏輯執行者**。當需要變更狀態時，流程如下：
    *   `Presenter` 層接收到用戶操作後，會呼叫一個特定的 `UseCase`。
    *   `UseCase` 執行相應的業務邏輯。如果需要與外部世界（如後端伺服器）互動，它會通過抽象的 **`Port`** 介面發出請求。
    *   在所有邏輯處理完畢、並從 `Port` 獲取到必要的數據後，`UseCase` 會**呼叫 `Store` 的內部方法來更新狀態**。這是對 SSoT 進行寫入的**唯一合法途徑**。
